<#
.SYNOPSIS
Set Exploit Protection Policy as required by the Windows 10 STIG.

.DESCRIPTION
The script sets the Exploit Protection Policy defined in the EP.xml file.

Windows 10 STIG
----------------
Finding ID: Multiple
Version:    Multiple
Rule ID:    Multiple

Exploit Protection mitigations in Windows 10 must be configured.

Description:
Windows PowerShell 5.0 added advanced logging features which can provide additional detail when malware has been run on a system. Disabling the Windows PowerShell 2.0 mitigates against a downgrade attack that evades the Windows PowerShell 5.0 script block logging feature.


.NOTES   
Name       : Set-ExploitProtection.ps1
Author     : Darren Hollinrake
Version    : 1.0
DateCreated: 2018-02-20
DateUpdated: 2018-07-21
#>

###############
#   Logging   #
###############
$LogPath = "C:\Temp\Logs\"
If (!(Test-Path "$LogPath")) {New-Item -ItemType Directory -Force -Path "$LogPath"}
$scriptname = [io.path]::GetFileNameWithoutExtension("$($MyInvocation.MyCommand.Name)")
$TransactionLog = $LogPath + $(Get-Date -Format yyyyMMdd) + "_" + $scriptname + ".log"
Start-Transcript -LiteralPath $TransactionLog

# Verify our policy file exists
If(!(Test-Path "$PSScriptRoot\EP.xml")) {
    Write-Output "`n*************************************************`n*       No policy file was found (EP.xml)       * `n*************************************************`n* Please ensure the file is located in the same *`n*   directory as this script and run it again.  *`n*************************************************`n `n"
    timeout 5
    exit
    }
# Apply the policy
Write-Host "Applying the Exploit Protection Policy located in the following location:'n$PSScriptRoot\EP.xml"
Set-ProcessMitigation -PolicyFilePath "$PSScriptRoot\EP.xml"

Stop-Transcript
